/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
tasks.register("build") {

    group = 'Anidia'
    description = 'Builds the whole project and copy all the components to liferay folder'

    dependsOn 'build.theme'
    dependsOn 'build.fragments'
    if( project.hasProperty('buildPublisher') && buildPublisher == "true") {
      dependsOn 'build.assetPublisher'
    }
    dependsOn 'build.portlets'

}

tasks.register("build.theme") {
  group = 'Anidia'
  description = 'Builds the theme and copy it to the deploy folder'

  doLast {
    exec {
      workingDir 'theme/anidia-theme'
      commandLine 'npx', 'gulp', 'build'
    }
    exec {
      commandLine 'cp', 'theme/anidia-theme/dist/anidia-theme.war', 'liferay/deploy'
    }
  }
}

tasks.register("build.fragments") {
  group = 'Anidia'
  description = 'Builds the fragments and copy them to the deploy folder'

  doLast {
    exec {
      workingDir 'theme/anidia-fragments'
      if( project.hasProperty('env')) {
        if( env=='production') {
          commandLine 'expect', 'compress-production.exp'
        } else {
          commandLine 'expect', 'compress-dev.exp'
        }
      } else {
        commandLine 'expect', 'compress-dev.exp'
      }
    }
    exec {
      commandLine 'cp', 'theme/anidia-fragments/build/liferay-fragments.zip', 'liferay/deploy'
    }
  }
}

tasks.register("build.assetPublisher") {

  group = 'Anidia'
  description = 'Builds everything related to Asset Publisher and copy it to the deploy folder'

  dependsOn 'build.assetPublisher.ext'
  dependsOn 'build.assetPublisher.jsp'
}

tasks.register("build.assetPublisher.ext") {
  group = 'Anidia'
  description = 'Builds the ext portlet required for the Asset Publisher and copy it to the deploy folder'

  doLast {
    exec {
      workingDir 'theme/anidia-portlets/LRWorkspace/ext/APOverride'
      commandLine 'gradle', 'deploy'
    }
    exec {
      commandLine 'cp', 'theme/anidia-portlets/LRWorkspace/bundles/osgi/marketplace/override/com.liferay.asset.publisher.web.jar', 'liferay/deploy'
    }
  }
}

tasks.register("build.assetPublisher.jsp") {
  group = 'Anidia'
  description = 'Builds the jsp override portlet required for the Asset Publisher and copy it to the deploy folder'

  doLast {
    exec {
      workingDir 'theme/anidia-portlets/module-jsp-override'
      commandLine 'gradle', 'build'
    }
    exec {
      commandLine 'cp', 'theme/anidia-portlets/module-jsp-override/build/libs/com.liferay.blade.module.jsp.override-1.0.0.jar', 'liferay/deploy'
    }
  }
}

tasks.register("build.portlets") {
  group = 'Anidia'
  description = 'Builds all the portlets and copy them to the deploy folder'

//    dependsOn 'build.portlets.contact_form'
    dependsOn 'build.portlets.gas_budget'

}

tasks.register("build.portlets.contact_form") {
  group = 'Anidia'
  description = 'Builds the Contact Form portlet and copy them to the deploy folder'

  doLast {
    exec {
      workingDir 'theme/anidia-portlets/ContactFormPortlet'
      commandLine 'gradle', 'build'
    }
    exec {
      commandLine 'cp', 'theme/anidia-portlets/ContactFormPortlet/build/libs/ContactFormPortlet.war', 'liferay/deploy'
    }
  }
}

tasks.register("build.portlets.gas_budget") {
  group = 'Anidia'
  description = 'Builds the Gas Budget portlet and copy them to the deploy folder'

  doLast {
    exec {
      workingDir 'theme/anidia-portlets/GasBudgetPortlet'
      commandLine 'gradle', 'build'
    }
    exec {
      commandLine 'cp', 'theme/anidia-portlets/GasBudgetPortlet/api/build/libs/gas-budget-api-1.0.0.jar', 'liferay/deploy'
    }
    exec {
      commandLine 'cp', 'theme/anidia-portlets/GasBudgetPortlet/impl/build/libs/gas-budget-impl-1.0.0.jar', 'liferay/deploy'
    }
    exec {
      commandLine 'cp', 'theme/anidia-portlets/GasBudgetPortlet/vue/dist/gas-budget-portlet-1.0.0.jar', 'liferay/deploy'
    }
  }
}